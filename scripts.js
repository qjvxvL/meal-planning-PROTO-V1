const weeklyPlans = [
  {
    name: "Mediterranean reset",
    days: [
      {
        day: "Monday",
        options: [
          {
            meal: "Lemon Herb Chicken Bowl",
            ingredients: [
              "Grilled chicken breast",
              "Quinoa",
              "Cherry tomatoes",
              "Cucumber",
              "Lemon-tahini drizzle",
            ],
          },
          {
            meal: "Chickpea Shawarma Pita",
            ingredients: [
              "Roasted chickpeas",
              "Whole-wheat pita",
              "Shredded lettuce",
              "Pickled onions",
              "Garlic yogurt sauce",
            ],
          },
        ],
      },
      {
        day: "Tuesday",
        options: [
          {
            meal: "Salmon Niçoise Salad",
            ingredients: [
              "Seared salmon",
              "Soft-boiled egg",
              "Green beans",
              "Fingerling potatoes",
              "Olives & Dijon vinaigrette",
            ],
          },
          {
            meal: "Roasted Veggie Couscous",
            ingredients: [
              "Pearl couscous",
              "Roasted zucchini",
              "Bell peppers",
              "Kalamata olives",
              "Feta & herb dressing",
            ],
          },
        ],
      },
      {
        day: "Wednesday",
        options: [
          {
            meal: "Shrimp Orzo Skillet",
            ingredients: [
              "Garlic shrimp",
              "Spinach",
              "Orzo pasta",
              "Sun-dried tomatoes",
              "Parmesan",
            ],
          },
          {
            meal: "Greek Lentil Soup",
            ingredients: [
              "Brown lentils",
              "Carrots & celery",
              "Diced tomatoes",
              "Spinach",
              "Crumbled feta",
            ],
          },
        ],
      },
      {
        day: "Thursday",
        options: [
          {
            meal: "Harissa Turkey Meatballs",
            ingredients: [
              "Turkey meatballs",
              "Bulgar wheat",
              "Roasted carrots",
              "Harissa glaze",
              "Mint yogurt",
            ],
          },
          {
            meal: "Stuffed Bell Pepper Boats",
            ingredients: [
              "Ground turkey",
              "Cauliflower rice",
              "Tomato basil sauce",
              "Spinach",
              "Pine nuts",
            ],
          },
        ],
      },
      {
        day: "Friday",
        options: [
          {
            meal: "Mediterranean Flatbread",
            ingredients: [
              "Whole-grain flatbread",
              "Roasted eggplant",
              "Hummus",
              "Baby arugula",
              "Pomegranate glaze",
            ],
          },
          {
            meal: "Seared Halloumi Bowl",
            ingredients: [
              "Halloumi cheese",
              "Farro",
              "Roasted red pepper",
              "Kale",
              "Herb vinaigrette",
            ],
          },
        ],
      },
      {
        day: "Saturday",
        options: [
          {
            meal: "Lamb Kofta Lettuce Wraps",
            ingredients: [
              "Grilled lamb kofta",
              "Butter lettuce",
              "Tomato-cucumber salsa",
              "Tzatziki",
              "Pickled radish",
            ],
          },
          {
            meal: "Roasted Vegetable Paella",
            ingredients: [
              "Saffron rice",
              "Artichoke hearts",
              "Roasted mushrooms",
              "Bell peppers",
              "Smoked paprika",
            ],
          },
        ],
      },
      {
        day: "Sunday",
        options: [
          {
            meal: "Baked Cod with Tapenade",
            ingredients: [
              "Cod fillets",
              "Olive tapenade",
              "Roasted potatoes",
              "Asparagus",
              "Lemon zest",
            ],
          },
          {
            meal: "Eggplant Parmesan Stack",
            ingredients: [
              "Roasted eggplant",
              "Marinara",
              "Mozzarella",
              "Basil",
              "Whole-grain crumbs",
            ],
          },
        ],
      },
    ],
  },
  {
    name: "Comfort reset",
    days: [
      {
        day: "Monday",
        options: [
          {
            meal: "BBQ Chicken Stuffed Sweet Potato",
            ingredients: [
              "Slow-cooked chicken",
              "Sweet potato",
              "Black beans",
              "Corn",
              "Yogurt ranch drizzle",
            ],
          },
          {
            meal: "Spinach Artichoke Pasta Bake",
            ingredients: [
              "Whole-wheat penne",
              "Spinach",
              "Artichoke hearts",
              "Greek yogurt sauce",
              "Parmesan",
            ],
          },
        ],
      },
      {
        day: "Tuesday",
        options: [
          {
            meal: "Turkey Taco Bowls",
            ingredients: [
              "Ground turkey",
              "Brown rice",
              "Pico de gallo",
              "Avocado",
              "Chipotle crema",
            ],
          },
          {
            meal: "Butternut Chili",
            ingredients: [
              "Ground beef",
              "Butternut squash",
              "Kidney beans",
              "Fire-roasted tomatoes",
              "Smoky spices",
            ],
          },
        ],
      },
      {
        day: "Wednesday",
        options: [
          {
            meal: "Sheet Pan Pesto Salmon",
            ingredients: [
              "Salmon",
              "Baby potatoes",
              "Broccolini",
              "Cherry tomatoes",
              "Basil pesto",
            ],
          },
          {
            meal: "Veggie Quinoa Bake",
            ingredients: [
              "Quinoa",
              "Roasted broccoli",
              "Caramelized onions",
              "Cheddar",
              "Bread crumb topping",
            ],
          },
        ],
      },
      {
        day: "Thursday",
        options: [
          {
            meal: "Teriyaki Beef Stir Fry",
            ingredients: [
              "Flank steak",
              "Snap peas",
              "Carrots",
              "Brown rice",
              "Teriyaki glaze",
            ],
          },
          {
            meal: "Cashew Cauliflower Stir Fry",
            ingredients: [
              "Roasted cauliflower",
              "Snow peas",
              "Cashews",
              "Brown rice",
              "Soy ginger sauce",
            ],
          },
        ],
      },
      {
        day: "Friday",
        options: [
          {
            meal: "Baked Ziti with Turkey",
            ingredients: [
              "Whole-wheat ziti",
              "Ground turkey",
              "Tomato basil sauce",
              "Ricotta",
              "Mozzarella",
            ],
          },
          {
            meal: "Stuffed Portobello Caps",
            ingredients: [
              "Portobello mushrooms",
              "Spinach ricotta filling",
              "Roasted peppers",
              "Balsamic glaze",
              "Panko crunch",
            ],
          },
        ],
      },
      {
        day: "Saturday",
        options: [
          {
            meal: "Crispy Cod Tacos",
            ingredients: [
              "Baked cod",
              "Warm tortillas",
              "Purple slaw",
              "Avocado crema",
              "Lime wedges",
            ],
          },
          {
            meal: "Sweet Potato Black Bean Quesadilla",
            ingredients: [
              "Roasted sweet potato",
              "Black beans",
              "Pepper jack",
              "Cilantro",
              "Chipotle dip",
            ],
          },
        ],
      },
      {
        day: "Sunday",
        options: [
          {
            meal: "Herb Roasted Chicken",
            ingredients: [
              "Whole roast chicken",
              "Root vegetables",
              "Pan gravy",
              "Mixed greens",
              "Cranberry relish",
            ],
          },
          {
            meal: "Mushroom Farro Risotto",
            ingredients: [
              "Farro",
              "Cremini mushrooms",
              "Vegetable broth",
              "Thyme",
              "Parmesan",
            ],
          },
        ],
      },
    ],
  },
  {
    name: "Plant-powered week",
    days: [
      {
        day: "Monday",
        options: [
          {
            meal: "Rainbow Buddha Bowl",
            ingredients: [
              "Roasted chickpeas",
              "Turmeric cauliflower",
              "Massaged kale",
              "Brown rice",
              "Avocado dressing",
            ],
          },
          {
            meal: "Tofu Satay Lettuce Cups",
            ingredients: [
              "Crispy tofu",
              "Butter lettuce",
              "Cucumber ribbons",
              "Peanut sauce",
              "Fresh herbs",
            ],
          },
        ],
      },
      {
        day: "Tuesday",
        options: [
          {
            meal: "Lentil Bolognese",
            ingredients: [
              "Whole-wheat spaghetti",
              "Red lentils",
              "Tomato sauce",
              "Carrots & celery",
              "Cashew parm",
            ],
          },
          {
            meal: "Thai Coconut Curry",
            ingredients: [
              "Butternut squash",
              "Chickpeas",
              "Snow peas",
              "Jasmine rice",
              "Coconut curry broth",
            ],
          },
        ],
      },
      {
        day: "Wednesday",
        options: [
          {
            meal: "Mediterranean Stuffed Sweet Potato",
            ingredients: [
              "Sweet potato",
              "Roasted chickpeas",
              "Tomato cucumber salad",
              "Tahini drizzle",
              "Herbed quinoa",
            ],
          },
          {
            meal: "Portobello Fajita Plate",
            ingredients: [
              "Sautéed portobello",
              "Peppers & onions",
              "Black beans",
              "Cilantro lime rice",
              "Guacamole",
            ],
          },
        ],
      },
      {
        day: "Thursday",
        options: [
          {
            meal: "Kimchi Fried Rice",
            ingredients: [
              "Kimchi",
              "Brown rice",
              "Scallions",
              "Crispy tofu",
              "Sesame seeds",
            ],
          },
          {
            meal: "Sesame Soba Bowl",
            ingredients: [
              "Soba noodles",
              "Edamame",
              "Shredded cabbage",
              "Snap peas",
              "Sesame ginger dressing",
            ],
          },
        ],
      },
      {
        day: "Friday",
        options: [
          {
            meal: "BBQ Jackfruit Sliders",
            ingredients: [
              "Whole-grain slider buns",
              "BBQ jackfruit",
              "Crunchy slaw",
              "Pickles",
              "Baked sweet potato fries",
            ],
          },
          {
            meal: "Grilled Veggie Pesto Pasta",
            ingredients: [
              "Grilled zucchini",
              "Cherry tomatoes",
              "Basil pesto",
              "Rigatoni",
              "Toasted pine nuts",
            ],
          },
        ],
      },
      {
        day: "Saturday",
        options: [
          {
            meal: "Falafel Mezze Plate",
            ingredients: [
              "Baked falafel",
              "Tabbouleh",
              "Hummus",
              "Cucumber salad",
              "Warm pita",
            ],
          },
          {
            meal: "Miso Mushroom Ramen",
            ingredients: [
              "Ramen noodles",
              "Shiitake mushrooms",
              "Baby bok choy",
              "Soft-boiled egg",
              "Miso broth",
            ],
          },
        ],
      },
      {
        day: "Sunday",
        options: [
          {
            meal: "Cauliflower Tikka Masala",
            ingredients: [
              "Roasted cauliflower",
              "Tomato tikka sauce",
              "Basmati rice",
              "Cilantro",
              "Garlic naan",
            ],
          },
          {
            meal: "Butternut Harvest Salad",
            ingredients: [
              "Roasted butternut squash",
              "Baby kale",
              "Candied pecans",
              "Dried cranberries",
              "Maple Dijon dressing",
            ],
          },
        ],
      },
    ],
  },
];

const planRows = document.querySelector("#plan-rows");
const refreshButton = document.querySelector("#refresh");
const refreshNote = document.querySelector("#refresh-limit");

let refreshesRemaining = 1;
let activePlanIndex = 0;
let activeOptionIndexes = [];

function randomPlanIndex() {
  return Math.floor(Math.random() * weeklyPlans.length);
}

function renderPlan(plan) {
  planRows.innerHTML = "";
  activeOptionIndexes = plan.days.map(() => 0);

  plan.days.forEach((dayPlan, dayIndex) => {
    const row = document.createElement("tr");

    const dayCell = document.createElement("td");
    dayCell.dataset.label = "Day";
    dayCell.textContent = dayPlan.day;

    const mealCell = document.createElement("td");
    mealCell.dataset.label = "Meal";

    const mealName = document.createElement("p");
    mealName.className = "meal-name";

    const ingredientList = document.createElement("ul");
    ingredientList.className = "ingredients";

    const ingredientsCell = document.createElement("td");
    ingredientsCell.dataset.label = "Ingredients";
    ingredientsCell.appendChild(ingredientList);

    const actionCell = document.createElement("td");
    actionCell.dataset.label = "Change";
    actionCell.className = "actions";

    const toggleButton = document.createElement("button");
    toggleButton.type = "button";
    toggleButton.className = "toggle";
    toggleButton.textContent = "Change meal";

    function updateMeal(optionIndex) {
      const currentOption = dayPlan.options[optionIndex];
      mealName.textContent = currentOption.meal;
      ingredientList.replaceChildren(
        ...currentOption.ingredients.map((item) => {
          const li = document.createElement("li");
          li.textContent = item;
          return li;
        })
      );
    }

    toggleButton.addEventListener("click", () => {
      const nextIndex = (activeOptionIndexes[dayIndex] + 1) % dayPlan.options.length;
      activeOptionIndexes[dayIndex] = nextIndex;
      updateMeal(nextIndex);
    });

    mealCell.appendChild(mealName);
    actionCell.appendChild(toggleButton);

    row.appendChild(dayCell);
    row.appendChild(mealCell);
    row.appendChild(ingredientsCell);
    row.appendChild(actionCell);

    planRows.appendChild(row);

    updateMeal(0);
  });
}

function setPlan(planIndex) {
  activePlanIndex = planIndex;
  const plan = weeklyPlans[planIndex];
  renderPlan(plan);
  document.title = `Weekly Meal Planner — ${plan.name}`;
}

refreshButton.addEventListener("click", () => {
  if (refreshesRemaining <= 0) {
    return;
  }

  let nextPlanIndex = randomPlanIndex();
  while (nextPlanIndex === activePlanIndex && weeklyPlans.length > 1) {
    nextPlanIndex = randomPlanIndex();
  }

  setPlan(nextPlanIndex);
  refreshesRemaining -= 1;
  refreshNote.textContent = `Refresh available: ${refreshesRemaining}`;
  if (refreshesRemaining <= 0) {
    refreshButton.disabled = true;
    refreshNote.textContent = "Refresh used up";
  }
});

setPlan(randomPlanIndex());
